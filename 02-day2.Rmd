# An die Daten! {#day2}

## What is Probability



Resourcen:

- [Seeing Theory](https://seeing-theory.brown.edu/)

```{r}
# What if the students of example1.csv choose their seats randomly?
# Create a vector with 7 female and 6 male students

# randomly select 7 students for the first row in the seminar room
 

# What is the probability to observe at least 6 female students in the first row,
# just by chance?
# We need a loop! Example for a loop:


# We want to repeat the random assignment of students to the first row
# in a loop 1000 times.
# We need a vector to store the results:


# How often did we see at least 6 female students in the first row?


# What is the exact p-value for 6 female students in the first row
# from the hypergeometric distribution?


# 3-dimensional arrays: UCBAdmissions as example

```

## Workflow einer Datenauswertung

```{r,fig.align='center', fig.cap="Quelle: @wickhamDataScienceImport2017", echo=FALSE}
knitr::include_graphics("img/workflow.png")
```

## Import

```{r}
library(tidyverse)
```


```{r}
# base-r would be:
# read.csv("data/01_starwars_example.csv")

# starwars <- read_csv("data/01_starwars_example.csv")
# head(starwars)
```

<!-- Das war einfach, wird aber nicht immer so sein. -->
<!-- Messy Data Example -->

## Visualize

```{r}
# starwars %>%
#   select(height, mass) %>%
#   ggplot(aes(x = mass, y = height)) +
#   geom_point()
```

```{r}
# starwars %>%
#   filter(mass > 1000) %>%
#   select(name)
```

```{r, fig.cap="Jabba the Hut, Quelle: Wikipedia", echo=FALSE}
knitr::include_graphics("img/jabba.png")
```


## Transform 

<!-- Jabba ist an dieser Stelle ganz klar ein Outlier. Und obwohl wir nicht einfach so Datenpunkte aus unserer Analyse entfernen können, ohne einen triftige Grund zu haben, wollen wir an dieser Stelle mal ein Auge zudrücken, um die anderen Charakter -->
<!-- vernünftig auf einen Graph packen zu können. -->

<!-- Außerdem sind die Massen in $kg$ angegeben, die Größen jedoch in $cm$ und -->
<!-- wir hätten gerne überall SI-Einheiten: -->

```{r}
# starwars <-
# starwars %>%
#   filter(mass < 1000) %>%
#   mutate(height = height / 100) %>% 
#   arrange(height)
```

```{r}
# p <- 
# starwars %>%
#   ggplot(aes(x = mass, y = height, color = species, label = name)) +
#   geom_point()
# 
# plotly::ggplotly(p)
```

```{r}
# hist(starwars$height)
```

```{r}
# starwars %>% 
#   filter(!is.na(height), !is.na(gender)) %>%
#   ggplot(aes(height, fill = gender)) +
#   geom_histogram(alpha = 0.8, position = "identity") +
#   theme_bw() +
#   scale_fill_brewer(type = "qual")
```

```{r}
# starwars %>% 
#   filter(!is.na(height), !is.na(gender)) %>%
#   ggplot(aes(height, fill = gender)) +
#   geom_histogram(alpha = 1, position = "identity") +
#   theme_bw() +
#   scale_fill_brewer(type = "qual") +
#   facet_wrap(~gender)
```


```{r}
# starwars %>% 
#   filter(!is.na(height), !is.na(gender)) %>%
#   ggplot(aes(height, fill = gender, color = gender)) +
#   geom_density(alpha = 0.8) +
#   theme_bw() +
#   scale_fill_brewer(type = "qual")
```

```{r}
# starwars %>% 
#   group_by(species) %>% 
#   summarise(
#     sd = sd(mass, na.rm = TRUE),
#     mass = mean(mass, na.rm = TRUE)
#     ) %>% 
#   arrange(-mass)
```

```{r}
# starwars %>% 
#   group_by(species) %>% 
#   summarise(
#     SD = sd(mass, na.rm = TRUE),
#     mass = mean(mass, na.rm = TRUE)
#     ) %>% 
#   arrange(-mass) %>%
#   filter(!is.nan(SD)) %>% 
#   ggplot(aes(x = species, y = mass)) +
#   geom_col(fill = "#0038D1", width = 0.8) +
#   geom_errorbar(aes(ymin = mass - SD, ymax = mass + SD), width = 0.3, size = 1.2) +
#   theme_classic()
```


## Übungen

### Histogramm

Erstelle ein Histogramm für die Gewichtsverteilung aller Charaktere aus
dem StarWars-Datenset.

### Barchart

Welche Species hat die schwersten Vertreter?

### Wahrscheinlichkeit

Wie Wahrscheinlich ist es, bei gleicher Verteilung von Geschlechtern im Universum,
allein durch Zufall diesen oder einen höheren Männerüberschuss in StarWars zu erhalten?

```{r}
# Note: This variable was called gender by the authors of the dataset,
# but I assume they meant sex.
starwars %>% count(gender)
male   <- 62
female <- 19
sum(male, female)
```

1b. Imagine the genes as red (involved in development) and blue 
(not involved in development) balls in a hat.
Simulate drawing 55 genes from the hat. Repeat this 1000 times. 
How often do you obtain 13 or more red balls 
(genes that are involved in development)?

```{r}
hat <- c("male", "female")
draw <- sample(hat, size =  81, replace = TRUE)

draw_from_hat <- function() {
  hat <- c("male", "female")
  draw <- sample(hat, size =  81, replace = TRUE)
  sum(draw == "male")
}

N <- 100000
draws <- map_int(1:N, ~draw_from_hat())
hist(draws)

sum(draws >= 62)

# phyper(62)
```



```{r}
## Exercises:
# 1a. Create a barplot showing the proportion (!) of genes involved in
# development among genes with and without CDE (see the pie of Exercise 1a of day 1).


# 1b. Imagine the genes as red (involved in development) and blue 
# (not involved in development) balls in a hat. 
# Simulate drawing 55 genes from the hat. Repeat this 1000 times. 
# How often do you obtain 13 or more red balls 
# (genes that are involved in development)?

# 1c. Obtain the hypergeometric p-value for an enrichment of genes 
# involved in development among genes with a CDE.


# 2a. Show the proportion of male and female students among admitted
# and rejected applicants at UC Berkeley in 1973 as stacked bar plot.


# 2b. Calculate a p-value for an overrepresentation of male students
# among the admitted students.


# 2c. Calculate the admission rates for male and female applicants separately for each department. 
# Try to use subsetting with [].
# Can you identify a department with an obvious bias against women? 


# 2d. Calculate the proportion of male and female applicants per department. 
# Which departments were popular among female applicants?
# Which departments were popular among male applicants?


# 2e. Calculate the overall admission rate (independent of male/female) for each department.


# 2f. Can you explain what happened?

## Homework
# Repeat what you did in Exercise 1a-c for genes in development among genes with and without CDE
# for genes with an AREScore > 5 among cytokine and non-cytokine genes.
```

